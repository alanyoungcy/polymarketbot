syntax = "proto3";

package polybot.v1;

option go_package = "github.com/alanyoungcy/polymarketbot/internal/pb/polybot/v1;polybotv1";

import "google/protobuf/timestamp.proto";
import "polybot/v1/order.proto";

// SignalUrgency indicates how quickly a signal should be acted upon.
enum SignalUrgency {
  SIGNAL_URGENCY_UNSPECIFIED = 0;
  SIGNAL_URGENCY_LOW = 1;
  SIGNAL_URGENCY_MEDIUM = 2;
  SIGNAL_URGENCY_HIGH = 3;
  SIGNAL_URGENCY_IMMEDIATE = 4;
}

// TradeSignal is a recommendation to place a trade, generated by a strategy.
message TradeSignal {
  // Unique signal identifier.
  string id = 1;

  // Source strategy or model that generated the signal.
  string source = 2;

  // Target market.
  string market_id = 3;

  // Target CLOB token.
  string token_id = 4;

  // Recommended side.
  OrderSide side = 5;

  // Recommended price (display units, e.g. 0.55).
  double price = 6;

  // Recommended size (display units).
  double size = 7;

  // How urgently the signal should be executed.
  SignalUrgency urgency = 8;

  // Human-readable reason for the signal.
  string reason = 9;

  // Arbitrary key-value metadata (e.g. model scores, feature values).
  map<string, string> metadata = 10;

  // When the signal was generated.
  google.protobuf.Timestamp created_at = 11;

  // When the signal expires (if applicable).
  google.protobuf.Timestamp expires_at = 12;
}

// ArbOpportunity represents a detected arbitrage between Polymarket and Kalshi.
message ArbOpportunity {
  // Unique opportunity identifier.
  string id = 1;

  // Polymarket market ID.
  string poly_market_id = 2;

  // Polymarket CLOB token ID.
  string poly_token_id = 3;

  // Polymarket price (display units).
  double poly_price = 4;

  // Kalshi market ID (ticker).
  string kalshi_market_id = 5;

  // Kalshi price (display units).
  double kalshi_price = 6;

  // Gross edge in basis points before costs.
  int32 gross_edge_bps = 7;

  // Direction of the arb (e.g. "BUY_POLY_SELL_KALSHI").
  string direction = 8;

  // Maximum notional amount executable.
  double max_amount = 9;

  // When the opportunity was detected.
  google.protobuf.Timestamp detected_at = 10;

  // How long the opportunity has persisted in milliseconds.
  int64 duration_ms = 11;

  // Whether this opportunity has been executed.
  bool executed = 12;

  // Estimated fee cost in basis points.
  int32 est_fee_bps = 13;

  // Estimated slippage in basis points.
  int32 est_slippage_bps = 14;

  // Estimated latency cost in basis points.
  int32 est_latency_bps = 15;

  // Net edge after all estimated costs (gross - fees - slippage - latency).
  int32 net_edge_bps = 16;

  // Expected profit in USD if executed at max_amount.
  double expected_pnl_usd = 17;
}
